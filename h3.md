# h3 Demoni

## Rauta, jolla tehtävät suoritetaan: 
* CPU: AMD Ryzen 9 5900x 12-core 3700MHz, boost 4950 MHz
* Muisti: 32 GB, 4 x 8G GSkill DDR4 3200c14
* Emolevy: ASUS ROG STRIX X570-E GAMING
* GPU: ASUS ROG STRIX RTX 2070 OC
* CPU & GPU jäähdytetty vedellä 
* OS: Windows 11, version 24H2
* VirtualBox - Debian 12.6.0

### x) Tiivistelmät
* Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port (https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/)
  * Artikkelissa käydään läpi demonien hallintaa
  * state (sshd.sls)- ja master-konffi (sshd_config)-filujen luominen
  * niiden ajaminen ja testaus
 
### a) Apache easy mode

Lähdin tekemään seuraavaksi vagrantilla tätä tehtävää. Tehtävää varten asensin uuden vagrant parin nimillä master ja slave. En käy tässä asennusta sen enempää läpi koska siinä ei ollut ongelmia ja edellisessä h2 tehtävässä käsiteltiin aihetta. 

Seuraavaksi lähdin asentamaan apachea käsin tehtävän annon mukaisesti `sudo apt-get -y install apache2` ja korvasin apachen testisivun `echo "<h1>Korvattu testisivu</h1>" | sudo tee /var/www/html/index.html`. Tämän jäåkleen käynnistin apachen sekä tarkistin sen tilan:

![image](https://github.com/user-attachments/assets/6a99254a-e1d4-410b-a2b8-e0e6a2eca918)

Seuraavaksi tarkistin testisivun:

![image](https://github.com/user-attachments/assets/a2aca9f7-1876-472a-b079-2f1d5aab966e)

Tämän jälkeen lähdin automatisoimaan äsken tehtyä operaatiota:
Loin masterille kansion `sudo mkdir -p /srv/salt/apache` sekä tiedoston `init.sls`:

![image](https://github.com/user-attachments/assets/f44b59c0-7531-4242-8129-b185ceecaa5c)

Tämän jälkeen loin vielä files kansion jonne loin uuden index.html tiedoston:

![image](https://github.com/user-attachments/assets/139873d4-70f6-4bd8-9069-3ef2efe57f12)

Tämän jälkeen ajoin komennon `sudo salt '*' state.apply apache` masterilla:

![image](https://github.com/user-attachments/assets/3b188789-d207-43a5-ab8c-8e47397caec1)

Homma onnistui muuten, mutta virheilmoituksesta päätellen olin laittanut index.html tiedostolle väärän polun. Tutkin tarkemmin sls-tiedostoa ja huomasin virheen polussa, joten korjasin sen muotoon:

![image](https://github.com/user-attachments/assets/8395fbff-16ab-422a-9ea3-30cf2b9a74ae)

Uusi ajo ja tuloksena onnistunut suoritus:

![image](https://github.com/user-attachments/assets/96ac28a8-e206-4afd-ab60-e6f45e50b24d)

Tarkistin vielä slave koneella, että siellä on sivu joka on vaihdettu oletuksesta:

![image](https://github.com/user-attachments/assets/4e6f92f8-b36e-4f79-8b0d-21904f7ee37a)




## Lähteet


* Karvinen, Tero. Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port, 2018. https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh - luettu 20.11.2024
